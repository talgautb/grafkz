$(document).ready(function(){function t(){function t(t){return t.pm=+t.pm,t}var e={top:20,right:20,bottom:30,left:40},n=720-e.left-e.right,r=400-e.top-e.bottom,a=d3.scale.ordinal().rangeRoundBands([0,n],.1),i=d3.scale.linear().range([r,0]),l=d3.svg.axis().scale(a).orient("bottom"),o=d3.svg.axis().scale(i).orient("left"),s=(d3.scale.linear().domain([0,10*.33,10*.66,10]).range(["#37bc9b","#ed5565","#4a89dc","#f6bb42"]),d3.scale.linear().range([0,n]),d3.scale.linear().range([r,0]),d3.svg.line().x(function(t){return a(t.year)}).y(function(t){return i(t.pm)})),c=d3.svg.line().x(function(t){return a(t.year)}).y(function(t){return i(0)}),u=d3.select("#maternal-mortality").append("svg").attr("width",n+e.left+e.right).attr("height",r+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");d3.tsv("women-parliament.tsv",t,function(t,e){a.domain(e.map(function(t){return t.year})),i.domain([0,d3.max(e,function(t){return t.pm})]),u.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+r+")").call(l).append("text").attr("y",19).attr("x",n-10).text("year");var d=u.append("svg:text").attr("class","text").attr("dx","20px").attr("dy","-5px");u.append("g").attr("class","axis axis--y").call(o).append("text").attr("y",-15).attr("x",-10).attr("dy",".71em").style("text-anchor","end").text("â€°"),u.append("path").datum(e).attr("class","line").style({"stroke-dasharray":"5"}).attr("d",c).transition().duration(2e3).attr("d",s).ease("easeOutQuad"),u.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").style({fill:function(t,e){return"#ccc"},opacity:"0.66"}).attr("height",function(t){return r-i(t.pm)}).attr("x",function(t){return a(t.year)}).attr("width",a.rangeBand()).attr("y",function(t){return i(t.pm)-500}).attr("height",function(t){return r-i(t.pm)}).on("mouseover",function(t,e,n){d.attr("x",a(t.year)).attr("y",i(t.pm)).text(t.pm).style({visibility:"visible",opacity:1})}).on("mouseout",function(){d.style({visibility:"hidden",opacity:0})}).transition().attr("y",function(t){return i(t.pm)}).delay(function(t,e){return 80*e}).duration(1500).ease("elastic-out-in")})}function e(){function t(t){return t.men=+t.men,t.women=+t.women,t.title=t.title,t}function e(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return o(e(t))}}var n=800,r=450,a=Math.min(n,r)/2,i=d3.scale.category10(),l=d3.layout.pie().value(function(t){return t.women}).sort(null),o=d3.svg.arc().innerRadius(a-100).outerRadius(a-20),s=d3.select("#daily-time-stock").append("svg").attr("width",n).attr("height",r).append("g").attr("transform","translate("+n/2+","+r/2+")"),c=d3.svg.arc().innerRadius(.9*a).outerRadius(.9*a);d3.tsv("daily-time-stock.tsv",t,function(t,n){function r(){var t=this.value;l.value(function(e){return e[t]}),d=d.data(l),d.transition().duration(750).attrTween("d",e),u(n)}function u(t){function e(t){return t.startAngle+(t.endAngle-t.startAngle)/2}var n=s.select(".labels").selectAll("text").data(l(t));n.enter().append("text").attr("dy",".35em").text(function(t,e){return t.data.title}),n.transition().duration(1e3).attrTween("transform",function(t){this._current=this._current||t;var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){var r=n(t),i=c.centroid(r);return i[0]=a*(e(r)<Math.PI?1:-1),"translate("+i+")"}}).styleTween("text-anchor",function(t){this._current=this._current||t;var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){var r=n(t);return e(r)<Math.PI?"start":"end"}}),n.exit().remove();var r=s.select(".lines").selectAll("polyline").data(l(t));r.enter().append("polyline"),r.transition().duration(1e3).attrTween("points",function(t){this._current=this._current||t;var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){var r=n(t),i=c.centroid(r);return i[0]=.95*a*(e(r)<Math.PI?1:-1),[o.centroid(r),c.centroid(r),i]}}),r.exit().remove()}var d=s.datum(n).selectAll("path").data(l).enter().append("path").attr("fill",function(t,e){return console.log(i(e)),i(e)}).attr("d",o).attr("data-legend",function(t){return t.data.title}).each(function(t){this._current=t});d3.selectAll("input").on("change",r),s.append("g").attr("class","labels"),s.append("g").attr("class","lines"),u(n,"women")})}var n=function(){var t,e={top:30,right:10,bottom:30,left:50},n=[10.4,10.4,10.4,10.4,10.5,10.5,10.4,16.8,17,17.8,17.8,17.8,23.8,26.2],r=400-e.top-e.bottom,a=720-e.left-e.right,i=[2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013],l=d3.scale.linear().domain([0,d3.max(n)]).range([0,r]),o=d3.scale.ordinal().domain(d3.range(0,n.length)).rangeBands([0,a]),s=d3.scale.linear().domain([0,.33*n.length,.66*n.length,n.length]).range(["#d6e9c6","#bce8f1","#faebcc","#ebccd1"]),c=d3.select("#women-parliament").append("svg").attr("width",a+e.left+e.right).attr("height",r+e.top+e.bottom).style("background","#fff").append("g").attr("transform","translate("+e.left+", "+e.top+")").selectAll("rect").data(n).enter().append("rect").style({fill:function(t,e){return"#2b908f"},stroke:"#fff","stroke-width":"1"}).attr("width",o.rangeBand()).attr("height",0).attr("x",function(t,e){return o(e)}).attr("y",function(t){return r-l(t)}).attr("height",0).attr("y",r).on("mouseover",function(e){t=this.style.fill,d3.select(this).style("fill",function(t){return s(t)})}).on("mouseout",function(e){d3.select(this).style("fill",t)});c.transition().attr("height",function(t){return l(t)}).attr("y",function(t){return r-l(t)}).delay(function(t,e){return 40*e}).duration(2e3).ease("elastic-in");var u=d3.scale.linear().domain([0,d3.max(n)]).range([r,0]),d=d3.svg.axis().scale(u).orient("left").ticks(10).tickFormat(function(t){return t+"%"}),f=d3.select("svg").append("g");d(f),f.attr("transform","translate("+e.left+", "+e.top+")"),f.selectAll("path").style({fill:"none",stroke:"#3c763d"}),f.selectAll("line").style({stroke:"#3c763d"});var p=d3.svg.axis().scale(o).orient("bottom").tickFormat(function(t){return i[t]}),h=d3.select("svg").append("g");p(h),h.attr("transform","translate("+e.left+", "+(r+e.top)+")"),h.selectAll("path").style({fill:"none",stroke:"#3c763d"}),h.selectAll("line").style({stroke:"#3c763d"})};n(),t(),e()});